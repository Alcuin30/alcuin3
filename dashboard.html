<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard TikTokeur</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg,#ff5f6d,#ffc371);
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    color: #fff;
  }
  #loginForm, #dashboard {
    background: rgba(0,0,0,0.7);
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 500px;
    text-align: center;
    animation: fadeIn 1s ease forwards;
  }
  @keyframes fadeIn { from {opacity:0; transform: translateY(20px);} to {opacity:1; transform:translateY(0);} }

  input { width: 80%; padding: 10px; margin: 8px 0; border-radius: 10px; border: none; }
  button { padding: 10px 20px; margin: 15px 0; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: transform 0.2s ease; }
  button:hover { transform: scale(1.05); background: #ffeb3b; color: #333; }

  .cards { display: flex; justify-content: space-around; flex-wrap: wrap; margin-top: 20px; }
  .card { background: #333; padding: 20px; border-radius: 15px; margin: 10px; flex: 1 1 40%; transition: transform 0.3s, background 0.3s; }
  .card:hover { transform: translateY(-5px); background: #444; }
  .card h3 { margin-bottom: 10px; }
  .card p { font-size: 1.2rem; font-weight: bold; }

  canvas { margin-top: 20px; background: #fff; border-radius: 15px; padding: 15px; color:#000; }
  #error { color: #ff6b6b; margin-top: 10px; }
</style>
</head>
<body>

<div id="loginForm">
  <h2>Connexion Admin</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Mot de passe"><br>
  <button id="loginBtn">Se connecter</button>
  <p id="error"></p>
</div>

<div id="dashboard" style="display:none;">
  <h2>ðŸ“Š Statistiques des clics</h2>
  <div class="cards">
    <div class="card"><h3>TikTok</h3><p id="tiktok-card">0</p></div>
    <div class="card"><h3>Instagram</h3><p id="instagram-card">0</p></div>
    <div class="card"><h3>YouTube</h3><p id="youtube-card">0</p></div>
    <div class="card"><h3>Contact</h3><p id="contact-card">0</p></div>
  </div>
  <canvas id="clickChart" width="400" height="200"></canvas>
  <button id="logoutBtn">Se dÃ©connecter</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

// ðŸ”¹ Config Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCy9MTpejGuqFhExb86liq8hMS4IL4Y9fA",
    authDomain: "tiktok-10341.firebaseapp.com",
    projectId: "tiktok-10341",
    storageBucket: "tiktok-10341.firebasestorage.app",
    messagingSenderId: "471916843086",
    appId: "1:471916843086:web:d385071adae7f92e92731f",
    measurementId: "G-PJEMFT2Z09"
  };

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ðŸ”¹ Login
const loginForm = document.getElementById("loginForm");
const dashboard = document.getElementById("dashboard");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const errorP = document.getElementById("error");

loginBtn.addEventListener("click", () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  signInWithEmailAndPassword(auth, email, password)
    .catch(err => { errorP.textContent = err.message; });
});

logoutBtn.addEventListener("click", () => { signOut(auth); });

onAuthStateChanged(auth, user => {
  if(user) {
    loginForm.style.display = "none";
    dashboard.style.display = "block";
    initDashboard();
  } else {
    loginForm.style.display = "block";
    dashboard.style.display = "none";
  }
});

// ðŸ”¹ Dashboard
let chart;
function initDashboard() {
  const ctx = document.getElementById('clickChart').getContext('2d');
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ["TikTok","Instagram","YouTube","Contact"],
      datasets: [{ label: 'Clics', data:[0,0,0,0], backgroundColor:['#ff5f6d','#ffc371','#1e90ff','#32cd32'] }]
    },
    options:{ responsive:true, scales:{ y:{ beginAtZero:true } } }
  });

  ["tiktok","instagram","youtube","contact"].forEach((key,i)=>{
    const ref = doc(db,"links",key);
    onSnapshot(ref,docSnap=>{
      if(docSnap.exists()){
        const val = docSnap.data().count;
        chart.data.datasets[0].data[i] = val;
        chart.update();
        document.getElementById(`${key}-card`).textContent = val;
      }
    });
  });
}
</script>

</body>
</html>
